/*! @wcjiang/notify v2.0.2 | MIT (c) 2018 kenny wang | http://jaywcjlove.github.io/iNotify */
"use strict";window.Notification&&"granted"!==window.Notification.permission&&window.Notification.requestPermission();var iconURL="",repeatableEffects=["flash","scroll"],defaultNotification={title:"\u901a\u77e5\uff01",body:"\u60a8\u6765\u4e86\u4e00\u6761\u65b0\u6d88\u606f",openurl:""};function jsonArguments(t,i){for(var e in i)t[e]&&(i[e]=t[e]);return i}function isArray(t){return"[object Array]"===Object.prototype.toString.call(t)}function createAudio(t){var i=document.createElement("audio"),e=void 0;if(isArray(t)&&0<t.length)for(var n=0;n<t.length;n++)(e=document.createElement("source")).src=t[n],e.type="audio/"+getExtension(t[n]),i.appendChild(e);else i.src=t;return i}function getFavicon(t){var i=document.querySelectorAll("link[rel~=shortcut]")[0];return i||(i=changeFavicon("O",t)),i}function getExtension(t){return t.match(/\.([^\\.]+)$/)[1]}function changeFavicon(t,i){var e=document.createElement("canvas"),n=document.getElementsByTagName("head")[0],o=document.createElement("link"),c=null;return e.height=32,e.width=32,(c=e.getContext("2d")).fillStyle=i.backgroundColor,c.fillRect(0,0,32,32),c.textAlign="center",c.font='22px "helvetica", sans-serif',c.fillStyle=i.textColor,c.fillText(t,16,24),o.setAttribute("rel","shortcut icon"),o.setAttribute("type","image/x-icon"),o.setAttribute("id","new "+i.id),o.setAttribute("href",e.toDataURL("image/png")),iconURL=e.toDataURL("image/png"),n.appendChild(o)}function Notify(t){t&&this.init(t)}Notify.prototype={init:function(t){return t||(t={}),this.interval=t.interval||200,this.effect=t.effect||"flash",this.title=t.title||document.title,this.message=t.message||this.title,this.onclick=t.onclick||this.onclick,this.openurl=t.openurl||this.openurl,this.updateFavicon=t.updateFavicon||{id:"favicon",textColor:"#fff",backgroundColor:"#2F9A00"},this.audio=t.audio||"",this.favicon=getFavicon(this.updateFavicon),this.cloneFavicon=this.favicon.cloneNode(!0),defaultNotification.icon=iconURL=t.notification&&t.notification.icon?t.notification.icon:t.icon?t.icon:this.favicon.href,this.notification=t.notification||defaultNotification,this.audio&&this.audio.file&&this.setURL(this.audio.file),this},render:function(){switch(this.effect){case"flash":document.title=this.title===document.title?this.message:this.title;break;case"scroll":document.title=document.title.slice(1),0===document.title.length&&(document.title=this.message)}},setURL:function(t){return t&&(this.audioElm&&this.audioElm.remove(),this.audioElm=createAudio(t),document.body.appendChild(this.audioElm)),this},loopPlay:function(){return this.setURL(),this.audioElm.loop=!0,this.player(),this},stopPlay:function(){return this.audioElm&&(this.audioElm.loop=!1,this.audioElm.pause()),this},player:function(){if(this.audio&&this.audio.file)return this.audioElm||(this.audioElm=createAudio(this.audio.file),document.body.appendChild(this.audioElm)),this.audioElm.play(),this},notify:function(t){var i=this.notification,e=t.openurl?t.openurl:this.openurl,n=t.onclick?t.onclick:this.onclick;if(window.Notification){i=t?jsonArguments(t,i):defaultNotification;var o={};o.icon=t.icon?t.icon:iconURL,o.body=i.body,t.dir&&(o.dir=t.dir);var c=new Notification(i.title,o);c.onclick=function(){n&&"function"==typeof n&&n(c),e&&window.open(e)},c.onshow=function(){t.onshow&&"function"==typeof t.onshow&&t.onshow(c)},c.onclose=function(){t.onclose&&"function"==typeof t.onclose&&t.onclose(c)},c.onerror=function(){t.onerror&&"function"==typeof t.onerror&&t.onerror(c)}}return this},isPermission:function(){return window.Notification&&"granted"===Notification.permission},setTitle:function(t){if(!0===t){if(0<=repeatableEffects.indexOf(this.effect))return this.addTimer()}else t?(this.message=t,this.addTimer()):(this.clearTimer(),this.title=t);return this},setInterval:function(t){return t&&(this.interval=t,this.addTimer()),this},setFavicon:function(t){if(!t&&0!==t)return this.faviconClear();var i=document.getElementById("new"+this.updateFavicon.id);return this.favicon&&this.favicon.remove(),i&&i.remove(),changeFavicon(t,this.updateFavicon),this},addTimer:function(){return this.clearTimer(),repeatableEffects.indexOf(this.effect)<0||(this.timer=setInterval(this.render.bind(this),this.interval)),this},faviconClear:function(){var t=document.getElementById("new"+this.updateFavicon.id),i=document.getElementsByTagName("head")[0],e=document.querySelectorAll("link[rel~=shortcut]");if(t&&t.remove(),0<e.length)for(var n=0;n<e.length;n++)e[n].remove();return i.appendChild(this.cloneFavicon),iconURL=this.cloneFavicon.href,this.favicon=this.cloneFavicon,this},clearTimer:function(){return clearInterval(this.timer),document.title=this.title,this}},module.exports=Notify;